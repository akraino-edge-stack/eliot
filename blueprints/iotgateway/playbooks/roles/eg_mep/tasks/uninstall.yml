# Copyright 2020 Huawei Technologies Co., Ltd.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

---

- name: Uninstall ssl config mep helm chart
  command: helm uninstall mep-edgegallery
  ignore_errors: yes
  no_log: True

- name: Delete ssl config pg secret
  command: kubectl delete secret pg-secret -n mep
  ignore_errors: yes
  no_log: True

- name: Delete ssl config mep ssl
  command: kubectl delete secret mep-ssl -n mep
  ignore_errors: yes
  no_log: True

- name: Delete ssl config mep mep auth
  command: kubectl delete secret mepauth-secret -n mep
  ignore_errors: yes
  no_log: True

- name: Delete dns namesapce metallb
  command: kubectl delete secret memberlist -n metallb-system
  ignore_errors: yes
  no_log: True

- name: Delete ssl config namesapce mep
  command: kubectl delete ns mep
  ignore_errors: yes
  no_log: True

- name: Delete network isolation multus eg sp controller
  # yamllint disable rule:line-length
  command: kubectl delete -f /tmp/eg_mep/deploy/conf/edge/network-isolation/eg-sp-controller.yaml
  ignore_errors: yes
  no_log: True

- name: Delete network isolation multus eg sp rbac
  # yamllint disable rule:line-length
  command: kubectl delete -f /tmp/eg_mep/deploy/conf/edge/network-isolation/eg-sp-rbac.yaml
  ignore_errors: yes
  no_log: True

- name: Delete network isolation multus
  # yamllint disable rule:line-length
  command: kubectl delete -f /tmp/eg_mep/deploy/conf/edge/network-isolation/multus.yaml
  ignore_errors: yes
  no_log: True

- name: Delete network isolation eg mp1
  command: ip link set dev eg-mp1 down
  ignore_errors: yes
  no_log: True

- name: Delete nnetwork isolation eg mp1 link
  command: ip link delete eg-mp1
  ignore_errors: yes
  no_log: True

- name: Delete network isolation eg mm5
  command: ip link set dev eg-mm5 down
  ignore_errors: yes
  no_log: True

- name: Delete network isolation eg mm5 link
  command: ip link delete eg-mm5
  ignore_errors: yes
  no_log: True

- name: Delete network isolation multus rm
  command: rm -rf /opt/cni/bin/multus
  ignore_errors: yes
  no_log: True

- name: Uninstall dns metallb config mep
  # yamllint disable rule:line-length
  command: kubectl delete -f /tmp/eg_mep/deploy/conf/edge/metallb/config-map.yaml
  ignore_errors: yes
  no_log: True

- name: Delete dns metallb
  # yamllint disable rule:line-length
  command: kubectl delete -f /tmp/eg_mep/deploy/conf/edge/metallb/metallb.yaml
  ignore_errors: yes
  no_log: True

- name: Delete dns metallb namespace
  # yamllint disable rule:line-length
  command: kubectl delete -f /tmp/eg_mep/deploy/conf/edge/metallb/namespace.yaml
  ignore_errors: yes
  no_log: True
